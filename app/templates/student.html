{% extends "base.html" %}
{%block title %} Students {% endblock %}
{%block studentLink%} nav-link active {% endblock %}

{%set tableid = "studentTable"%}
{%set urlRedirect = "student.delete"%}
{%set deleteWarningMsg = "Confirm deletion of student?"%}

{%block content%}
{%include "search.html"%}

<br>
    <div class = "container d-flex justify-content-center">
        <button type="button" class="btn btn-success " data-bs-toggle="modal" data-bs-target="#addStudent"> ADD STUDENT </button>
    </div>
<br>

    {%include "table.html"%}

<!----edit Modal---->
        <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title fs-5" id="editModalLabel">EDIT STUDENT</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action ="{{url_for('student.update')}}" method="POST">
                            <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
                            <br>
                            <div class="row">
                                <label for = "idEditOne"  class = "form-label"> Student ID </label>
                                <div class="col-3">
                                    <input type="hidden" name="initIdEditOne" id = "initIdEditOne" readonly>
                                    <input name = "idOne_edit" id = "idEditOne"  type="text" inputmode = "numeric" class="form-control" placeholder="Ex. 1234" pattern = "\d*" maxlength = "4"  minlength = "4"  required>
                                </div>
                                <div class="col-1 text-center">
                                    <h3>-<h3>
                                </div>
                                <div class="col-3">
                                    <input type="hidden" name="initIdEditTwo"  id = "initIdEditTwo" readonly>
                                    <input name = "idTwo_edit" id = "idEditTwo" type="text" inputmode = "numeric" class="form-control" placeholder="Ex. 1234" pattern = "\d*" maxlength = "4" minlength = "4" required>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col">
                                    <label for = "fNameEdit" class = "form-label"> First Name </label>
                                    <input name = "first_name_edit" id = "fNameEdit" type="text" class="form-control" placeholder="First name" aria-label="First name" maxlength ="40" required>
                                </div>
                                <div class="col">
                                    <label for = "lNameEdit" class = "form-label"> Last Name </label>
                                    <input name = "last_name_edit" id = "lNameEdit" type="text" class="form-control" placeholder="Last name" aria-label="Last name" maxlength ="40" required>
                                </div>
                            </div>
                            <br>
                            <div class = row>
                                <div class ="col">
                                    <label for = "cCodeEdit" class = "form-label"> Course Code </label>
                                    <select name = "course_code_edit" id ="cCodeEdit" class="form-select form-select-sm mb-3" aria-label="Large select example">
                                        {%for item in courses%}
                                            <option value="{{item.values()|list|first}}">{{ item.values()|list|first }}</option>
                                        {%endfor%}
                                    </select>
                                </div>

                                <div class ="col">
                                    <label for = "yLevelEdit" class = "form-label"> Year Level </label>
                                    <select name = "year_level_edit" id="yLevelEdit" class="form-select form-select-sm mb-3" aria-label="Large select example">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                    </select>
        
                                </div>

                                <div class ="col">
                                    <label for = "gEdit" class = "form-label"> Gender </label>
                                    <select name = "gender_edit" id ="gEdit" class="form-select form-select-sm mb-3" aria-label="Large select example">
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                    </select>
        
                                </div>
                            
                            </div>
                            
                            <div class="modal-footer">
            
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-success">Save changes</button>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>

          <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
          <script>
            $('button[data-bs-toggle="modal"]').click(function() {
                console.log("Edit button clicked.");
                let row = $(this).closest('tr');
                let studentId = row.find('td:eq(0)').text();
                let fNameEdit = row.find('td:eq(1)').text();
                let lNameEdit = row.find('td:eq(2)').text();
                let cCodeEdit = row.find('td:eq(3)').text();
                let yLevelEdit = row.find('td:eq(4)').text();
                let gEdit = row.find('td:eq(5)').text();
                console.log(cCodeEdit);

                splitId = studentId.split("-");
                console.log(splitId);
                let idOne = splitId[0];
                let idTwo = splitId[1];

                $('#idEditOne').val(idOne);
                $('#idEditTwo').val(idTwo);
                $('#fNameEdit').val(fNameEdit);
                $('#lNameEdit').val(lNameEdit);
                $('#cCodeEdit').val(cCodeEdit);
                $('#yLevelEdit').val(yLevelEdit);
                $('#gEdit').val(gEdit);

                $('#initIdEditOne').val(idOne);
                $('#initIdEditTwo').val(idTwo);
                // Set values of other fields similarly
            });
          </script>
<!----add Modal---->

    <div class="modal fade" id="addStudent" tabindex="-1" aria-labelledby="addStudentLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">ADD STUDENT</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <br>
            <div class="modal-body">
                <form action ="{{url_for('student.insert')}}" method = "POST">
                    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
                    <div class="row">
                        <label for = "idOne" class = "form-label"> Student ID </label>
                        <div class="col-3">
                            <input name = "idOne"  type="text" inputmode = "numeric" class="form-control" placeholder="YYYY" pattern = "\d*" maxlength = "4"  minlength = "4" required>
                        </div>
                        <div class="col-1 text-center">
                            <h3>-</h3>
                        </div>
                        <div class="col-3">
                            <input name = "idTwo"  type="text" inputmode = "numeric" class="form-control" placeholder="NNNN" pattern = "\d*" maxlength = "4" minlength = "4" required>
                        </div>
                    </div>

                    <br>

                    <div class="row">
                        <div class="col">
                            <label for = "fName" class = "form-label"> First Name </label>
                            <input name = "first_name" id = "fName" type="text" class="form-control" placeholder="First name" aria-label="First name" maxlength ="40" required>
                        </div>
                        <div class="col">
                            <label for = "lName" class = "form-label"> Last Name </label>
                            <input name = "last_name" id = "lName" type="text" class="form-control" placeholder="Last name" aria-label="Last name" maxlength ="40" required>
                        </div>
                    </div>
                    <br>
                    <div class = "row">
                        <div class ="col">
                            <label for = "cCode" class = "form-label"> Course Code </label>
                            <select name = "course_code" id = "cCode" class="form-select form-select-sm mb-3" aria-label="Large select example">
                                {%for item in courses%}
                                    <option value="{{item.values()|list|first}}">{{ item.values()|list|first }}</option>
                                {%endfor%}
                            </select>
                        </div>
                        <div class ="col">
                            <label for = "yLevel" class = "form-label"> Year Level </label>
                            <select name = "year_level" id = "yLevel" class="form-select form-select-sm mb-3" aria-label="Large select example">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>

                        </div>

                        <div class ="col">
                            <label for = "fGender" class = "form-label"> Gender </label>
                            <select name = "gender" id = "fGender" class="form-select form-select-sm mb-3" aria-label="Large select example">
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>

                        </div>
                    <div>
                </form>
            </div>
            <br>
            <br>
            <br>
            <div class="modal-footer">
            
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-success">Save changes</button>
            </div>
          </div>
        </div>
    </div>

{%endblock%}
